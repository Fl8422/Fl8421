<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Симулятор Шахтера</title>
    <style>
        /* Общие стили */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            transition: background-color 0.5s;
        }

        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #333;
            color: #fff;
            padding: 10px 20px;
            border-radius: 10px;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        header .stats {
            display: flex;
            gap: 20px;
        }

        main {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            flex: 1 1 300px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        section h2 {
            margin-top: 0;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        button:active {
            background-color: orange;
            transform: scale(0.95);
        }

        .shop-item, .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        .shop-item:last-child, .inventory-item:last-child {
            border-bottom: none;
        }

        .shop-item button, .inventory-item button {
            padding: 5px 10px;
            font-size: 14px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 10px;
            background-color: #333;
            color: #fff;
            border-radius: 10px;
        }

        /* Фон по планетам */
        .planet-earth { background-color: green; }
        .planet-moon { background-color: white; }
        .planet-mars { background-color: red; }
        .planet-venus { background-color: orange; }
        .planet-mercury { background-color: beige; }
    </style>
</head>
<body class="planet-earth">
    <div id="game-container">
        <header>
            <h1>Симулятор Шахтера</h1>
            <div class="stats">
                <div>Монеты: <span id="coin-count">0</span></div>
                <div>Множитель: <span id="coin-multiplier">x1</span></div>
            </div>
        </header>
        
        <main>
            <!-- Действия -->
            <section id="actions">
                <h2>Действия</h2>
                <button id="mine-button">Добыть Руду</button>
                <div id="mine-result" style="margin-top:10px;"></div>
            </section>
            
            <!-- Магазин -->
            <section id="shop">
                <h2>Магазин</h2>
                <!-- Магазин будет заполнен скриптом -->
            </section>
            
            <!-- Инвентарь -->
            <section id="inventory">
                <h2>Инвентарь</h2>
                <div id="inventory-list">
                    <!-- Инвентарь будет заполнен скриптом -->
                </div>
            </section>
            
            <!-- Портфель -->
            <section id="portfolio">
                <h2>Портфель</h2>
                <p>Не переплавленная руда: <span id="raw-ore">0</span></p>
                <p>Переплавленная руда: <span id="smelted-ore">0</span></p>
                <button id="sell-button">Продать Руду</button>
            </section>
            
            <!-- Ребирты -->
            <section id="rebirth">
                <h2>Ребирты</h2>
                <button id="rebirth-button">Ребирт</button>
                <p>Текущий множитель: <span id="current-multiplier">x1</span></p>
            </section>
            
            <!-- Планеты -->
            <section id="planets">
                <h2>Планеты</h2>
                <div id="planet-list">
                    <!-- Планеты будут заполнены скриптом -->
                </div>
            </section>
            
            <!-- Кейсы -->
            <section id="cases">
                <h2>Кейсы</h2>
                <div class="shop-item">
                    <span>Кейс 1 (7500 монет)</span>
                    <button data-case="1">Купить</button>
                </div>
                <div class="shop-item">
                    <span>Кейс 2 (15000 монет)</span>
                    <button data-case="2">Купить</button>
                </div>
            </section>
        </main>
        
        <footer>
            <p>© 2024 Симулятор Шахтера</p>
        </footer>
    </div>
    
    <script>
        // Инициализация переменных
        let coins = 0;
        let multiplier = 1;
        let rebirthCount = 0;
        let currentPlanetIndex = 0;
        const planets = [
            { name: 'Земля', cost: 0, background: 'planet-earth' },
            { name: 'Луна', cost: 450000, background: 'planet-moon' },
            { name: 'Марс', cost: 750000, background: 'planet-mars' },
            { name: 'Венера', cost: 1300000, background: 'planet-venus' },
            { name: 'Меркурий', cost: 1750000, background: 'planet-mercury' }
        ];

        const ores = [
            // Пример 4 руд для каждой планеты, расширьте до 20 по необходимости
            { name: 'Железная руда', value: 100 },
            { name: 'Медная руда', value: 200 },
            { name: 'Золотая руда', value: 500 },
            { name: 'Алмазная руда', value: 1000 }
        ];

        const pickaxes = [];
        const miners = [];
        const rebirths = [];
        const cases = [
            { id: 1, cost: 7500, min: 5000, max: 10000 },
            { id: 2, cost: 15000, min: 10000, max: 20000 }
        ];

        // Элементы DOM
        const coinCountEl = document.getElementById('coin-count');
        const coinMultiplierEl = document.getElementById('coin-multiplier');
        const mineResultEl = document.getElementById('mine-result');
        const mineButton = document.getElementById('mine-button');
        const sellButton = document.getElementById('sell-button');
        const rawOreEl = document.getElementById('raw-ore');
        const smeltedOreEl = document.getElementById('smelted-ore');
        const rebirthButton = document.getElementById('rebirth-button');
        const currentMultiplierEl = document.getElementById('current-multiplier');
        const shopEl = document.getElementById('shop');
        const inventoryListEl = document.getElementById('inventory-list');
        const planetListEl = document.getElementById('planet-list');
        const casesButtons = document.querySelectorAll('#cases button');

        // Инвентарь и портфель
        let inventory = {
            pickaxes: [],
            miners: []
        };
        let portfolio = {
            raw: 0,
            smelted: 0
        };

        // Функция обновления отображения
        function updateDisplay() {
            coinCountEl.textContent = coins.toLocaleString();
            coinMultiplierEl.textContent = `x${multiplier}`;
            currentMultiplierEl.textContent = `x${multiplier}`;
            rawOreEl.textContent = portfolio.raw;
            smeltedOreEl.textContent = portfolio.smelted;
            updateInventory();
            updatePlanets();
        }

        // Функция добычи руды
        mineButton.addEventListener('click', () => {
            const minedOres = getRandomInt(1, 3);
            const ore = ores[getRandomInt(0, ores.length - 1)];
            portfolio.raw += minedOres;
            mineResultEl.textContent = `Вы добыли ${minedOres} ${ore.name}`;
            coins += minedOres * ore.value * multiplier;
            updateDisplay();
        });

        // Функция продажи руды
        sellButton.addEventListener('click', () => {
            if (portfolio.smelted > 0) {
                coins += portfolio.smelted * 100 * multiplier; // Предположим, каждая переплавленная руда продаётся за 100 монет
                portfolio.smelted = 0;
                updateDisplay();
                alert('Вы продали переплавленную руду.');
            } else {
                alert('Нет переплавленной руды для продажи.');
            }
        });

        // Функция ребирта
        rebirthButton.addEventListener('click', () => {
            if (rebirthCount < 10) {
                const rebirthCost = 1000000 * Math.pow(2, rebirthCount);
                if (coins >= rebirthCost && currentPlanetIndex === planets.length -1) { // Ребирты только на Меркурии
                    coins = 0;
                    multiplier *= 2;
                    rebirthCount += 1;
                    updateDisplay();
                    alert(`Вы совершили ребирт! Множитель увеличен до x${multiplier}`);
                } else if(currentPlanetIndex !== planets.length -1){
                    alert('Ребирты доступны только на планете Меркурий.');
                } else {
                    alert('Недостаточно монет или достигнут лимит ребиртов.');
                }
            } else {
                alert('Достигнут максимальный уровень ребиртов.');
            }
        });

        // Функция покупки кейсов
        casesButtons.forEach(button => {
            button.addEventListener('click', () => {
                const caseId = parseInt(button.getAttribute('data-case'));
                const selectedCase = cases.find(c => c.id === caseId);
                if (coins >= selectedCase.cost) {
                    coins -= selectedCase.cost;
                    const reward = getRandomInt(selectedCase.min, selectedCase.max);
                    coins += reward;
                    updateDisplay();
                    alert(`Вы получили ${reward} монет из кейса ${selectedCase.id}!`);
                } else {
                    alert('Недостаточно монет для покупки кейса.');
                }
            });
        });

        // Функция покупки предметов из магазина
        function purchaseItem(category, item) {
            if (coins >= item.cost) {
                coins -= item.cost;
                inventory[category].push(item);
                alert(`Вы купили ${item.name}`);
                updateDisplay();
            } else {
                alert('Недостаточно монет.');
            }
        }

        // Функция отображения магазина
        function displayShop() {
            // Пример предметов, расширьте по необходимости
            const shopItems = {
                pickaxes: [
                    { id: 1, name: 'Кирка I', cost: 100000, level: 1 },
                    { id: 2, name: 'Кирка II', cost: 500000, level: 2 },
                    // Добавьте до 15 уровней
                ],
                miners: [
                    { id: 1, name: 'Майнер I', cost: 100000, income: 7000, interval: 43200000 }, // 12 часов
                    { id: 2, name: 'Майнер II', cost: 200000, income: 14000, interval: 43200000 },
                    // Добавьте до 10 уровней
                ],
                // Добавьте другие категории: портфели, печки, шахты и т.д.
            };

            for (let category in shopItems) {
                const section = document.createElement('div');
                section.innerHTML = `<h3>${capitalizeFirstLetter(category)}</h3>`;
                shopItems[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'shop-item';
                    itemDiv.innerHTML = `
                        <span>${item.name} - ${item.cost.toLocaleString()} монет</span>
                        <button onclick="purchaseItem('${category}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">Купить</button>
                    `;
                    section.appendChild(itemDiv);
                });
                shopEl.appendChild(section);
            }
        }

        // Функция обновления инвентаря
        function updateInventory() {
            inventoryListEl.innerHTML = '';
            for (let category in inventory) {
                inventoryListEl.innerHTML += `<h4>${capitalizeFirstLetter(category)}</h4>`;
                inventory[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'inventory-item';
                    itemDiv.textContent = `${item.name} (Уровень ${item.level || item.id})`;
                    inventoryListEl.appendChild(itemDiv);
                });
            }
        }

        // Функция отображения планет
        function displayPlanets() {
            planets.forEach((planet, index) => {
                const planetDiv = document.createElement('div');
                planetDiv.className = 'shop-item';
                planetDiv.innerHTML = `
                    <span>${planet.name} - ${planet.cost === 0 ? 'Начальная планета' : planet.cost.toLocaleString() + ' монет'}</span>
                    ${planet.cost === 0 ? '<span>✔</span>' : `<button onclick="changePlanet(${index})">Купить</button>`}
                `;
                planetListEl.appendChild(planetDiv);
            });
        }

        // Функция изменения планеты
        function changePlanet(index) {
            const planet = planets[index];
            if (coins >= planet.cost) {
                coins -= planet.cost;
                currentPlanetIndex = index;
                document.body.className = planet.background;
                updateDisplay();
                alert(`Вы переместились на планету ${planet.name}`);
                updatePlanets();
            } else {
                alert('Недостаточно монет для покупки планеты.');
            }
        }

        // Функция обновления списка планет
        function updatePlanets() {
            planetListEl.innerHTML = '';
            planets.forEach((planet, index) => {
                const planetDiv = document.createElement('div');
                planetDiv.className = 'shop-item';
                if (index === currentPlanetIndex) {
                    planetDiv.innerHTML = `<span>${planet.name} - Текущая планета</span>`;
                } else {
                    planetDiv.innerHTML = `
                        <span>${planet.name} - ${planet.cost.toLocaleString()} монет</span>
                        <button onclick="changePlanet(${index})">Купить</button>
                    `;
                }
                planetListEl.appendChild(planetDiv);
            });
        }

        // Утилиты
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Пассивный доход от майнеров
        function startPassiveIncome() {
            inventory.miners.forEach(miner => {
                setInterval(() => {
                    coins += miner.income * multiplier;
                    updateDisplay();
                }, miner.interval);
            });
        }

        // Сохранение и загрузка игры
        function saveGame() {
            const gameData = {
                coins,
                multiplier,
                rebirthCount,
                currentPlanetIndex,
                inventory,
                portfolio
            };
            localStorage.setItem('minerGameData', JSON.stringify(gameData));
        }

        function loadGame() {
            const savedData = JSON.parse(localStorage.getItem('minerGameData'));
            if (savedData) {
                coins = savedData.coins;
                multiplier = savedData.multiplier;
                rebirthCount = savedData.rebirthCount;
                currentPlanetIndex = savedData.currentPlanetIndex;
                inventory = savedData.inventory;
                portfolio = savedData.portfolio;
                document.body.className = planets[currentPlanetIndex].background;
                updateDisplay();
                startPassiveIncome();
            }
        }

        // Инициализация игры
        function init() {
            displayShop();
            displayPlanets();
            updateDisplay();
            loadGame();
        }

        // Сохранение игры при закрытии страницы
        window.addEventListener('beforeunload', saveGame);

        // Запуск игры
        init();
    </script>
</body>
</html>
